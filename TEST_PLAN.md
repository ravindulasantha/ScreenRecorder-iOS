# Screen Recorder App - Test Plan

## 1. Introduction

### 1.1 Purpose
This document outlines the test plan for the Screen Recorder Flutter application. The purpose is to verify that the application functions as intended, is user-friendly, and handles errors gracefully.

### 1.2 Scope
The scope of this testing includes:
- UI verification and responsiveness (simulated).
- Permission handling for microphone, storage, and photos.
- Core recording functionality (start, stop, countdown).
- Video resolution settings.
- File saving to the device gallery.
- Error handling and user feedback.
- Basic unit tests for utility functions.

**Out of Scope:**
- Performance testing under heavy load.
- Automated UI testing (due to environment limitations).
- Testing on specific physical iOS device configurations beyond generic simulator behavior.
- Network-dependent features (none currently exist).

## 2. Test Environment
- **Framework:** Flutter (latest stable version available in the test environment)
- **Target Platforms (Simulated/Manual):** Android (primarily), iOS (conceptual, based on Flutter's cross-platform nature).
- **Testing Tools:**
    - Flutter CLI for running the app (if possible in the environment).
    - Manual inspection and interaction.
    - `flutter test` for unit tests.
- **Dependencies to note for testing:** `flutter_screen_recording`, `permission_handler`, `gallery_saver`.

## 3. Manual Test Cases

### 3.1 UI Testing

| Test Case ID | Description                                                                 | Steps                                                                                                                               | Expected Result                                                                                                                                  | Actual Result | Status (Pass/Fail) | Notes                                                  |
|--------------|-----------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------|---------------|--------------------|--------------------------------------------------------|
| UI-001       | Verify initial UI elements display                                          | 1. Launch the app.                                                                                                                  | - App bar with "Screen Recorder" title. <br>- "Enable 3s Countdown" switch (default on). <br>- "Select Resolution" label and dropdown (default '720p'). <br>- Status text "Stopped". <br>- Duration text "00:00:00". <br>- Play icon button. |               |                    |                                                        |
| UI-002       | Test Countdown Switch functionality                                         | 1. Tap the "Enable 3s Countdown" switch. <br>2. Tap it again.                                                                       | - Switch toggles its state (on/off). <br>- State is visually distinct.                                                                          |               |                    |                                                        |
| UI-003       | Test Resolution Dropdown functionality                                      | 1. Tap the resolution dropdown. <br>2. Select a different resolution (e.g., '1080p'). <br>3. Tap again and select '480p'.            | - Dropdown shows list: '480p', '720p', '1080p', '2K', '4K'. <br>- Selected resolution is displayed.                                            |               |                    |                                                        |
| UI-004       | Test Record Button state change (Play -> Stop during countdown)             | 1. Ensure "Enable 3s Countdown" is ON. <br>2. Tap the Play button.                                                                  | - Play button icon changes to a Stop icon. <br>- Button color changes to red. <br>- Status text changes to "Countdown..." then "Starting in X...". |               |                    |                                                        |
| UI-005       | Test Record Button state change (Play -> Stop during recording)             | 1. Ensure "Enable 3s Countdown" is OFF. <br>2. Tap the Play button. <br>3. Wait 2 seconds.                                           | - Play button icon changes to a Stop icon. <br>- Button color changes to red. <br>- Status text changes to "Recording...".                          |               |                    |                                                        |
| UI-006       | Test Record Button state change (Stop -> Play after recording)            | 1. Start a recording. <br>2. Tap the Stop button.                                                                                   | - Stop button icon changes back to a Play icon. <br>- Button color changes to green. <br>- Status text changes to "Stopped".                       |               |                    |                                                        |
| UI-007       | Verify Countdown Overlay                                                    | 1. Ensure "Enable 3s Countdown" is ON. <br>2. Tap the Play button.                                                                  | - A semi-transparent overlay appears. <br>- Countdown numbers (3, 2, 1) are displayed centrally with large font. <br>- Overlay disappears after countdown. |               |                    |                                                        |
| UI-008       | Verify UI elements are disabled during recording/countdown                  | 1. Start recording (with or without countdown).                                                                                     | - "Enable 3s Countdown" switch is disabled. <br>- Resolution dropdown is disabled.                                                               |               |                    |                                                        |
| UI-009       | Verify UI elements are enabled after recording stops                        | 1. Start recording. <br>2. Stop recording.                                                                                        | - "Enable 3s Countdown" switch is enabled. <br>- Resolution dropdown is enabled.                                                                |               |                    |                                                        |
| UI-010       | (Conceptual) Test UI responsiveness on different screen sizes (Simulated) | 1. Imagine running on a small phone. <br>2. Imagine running on a tablet.                                                            | - UI elements should remain visible and not overflow. <br>- Layout should adapt reasonably (e.g., text wrapping).                               |               |                    | This is a thought experiment due to environment limits |

### 3.2 Permission Handling

| Test Case ID | Description                                                                | Steps                                                                                                                                                                                             | Expected Result                                                                                                                                                                                             | Actual Result | Status (Pass/Fail) | Notes                                                                                               |
|--------------|----------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------|--------------------|-----------------------------------------------------------------------------------------------------|
| PERM-001     | Grant all permissions (Microphone, Storage, Photos) - First Time           | 1. Fresh install (or clear app data). <br>2. Tap the Play button. <br>3. When permission prompts appear, grant all requested permissions.                                                         | - App requests Microphone, Storage, and Photos permissions. <br>- Recording starts (either countdown or actual recording). <br>- No permission error SnackBar.                                                  |               |                    | Assumes `flutter_screen_recording` or `permission_handler` shows individual prompts if not batched. |
| PERM-002     | Deny one permission (e.g., Microphone) - First Time                        | 1. Fresh install. <br>2. Tap Play. <br>3. Grant Storage & Photos, but Deny Microphone.                                                                                                           | - A SnackBar appears: "Permissions required: microphone. Please grant access." (or similar, listing denied ones). <br>- Recording does not start. <br>- Status remains "Stopped".                               |               |                    |                                                                                                     |
| PERM-003     | Deny all permissions - First Time                                          | 1. Fresh install. <br>2. Tap Play. <br>3. Deny all permissions when prompted.                                                                                                                    | - A SnackBar appears: "Permissions required: microphone, storage, photos. Please grant access." (or similar). <br>- Recording does not start. <br>- Status remains "Stopped".                                     |               |                    |                                                                                                     |
| PERM-004     | Permissions initially denied, then granted via app settings                | 1. Follow PERM-003 (deny all). <br>2. Manually go to app settings (OS level) and grant Microphone, Storage, and Photos permissions. <br>3. Return to the app. <br>4. Tap the Play button.          | - Recording starts successfully (countdown or actual). <br>- No permission error SnackBar.                                                                                                                  |               |                    | This tests if the app correctly re-checks permissions.                                              |
| PERM-005     | Permissions granted, then one revoked via app settings                     | 1. Follow PERM-001 (grant all). <br>2. Start a recording, then stop it. <br>3. Manually go to app settings and revoke Storage permission. <br>4. Return to app. <br>5. Tap Play button.          | - A SnackBar appears: "Permissions required: storage. Please grant access." (or similar). <br>- Recording does not start.                                                                                      |               |                    |                                                                                                     |
| PERM-006     | Attempt to record after "Don't Ask Again" (Permanently Denied)             | 1. Deny a permission multiple times until "Don't Ask Again" is triggered (if OS supports this flow clearly). <br>2. Tap Play.                                                                     | - SnackBar appears indicating permission is required. <br>- App should ideally guide user to settings (though current SnackBar message is generic). <br>- Recording does not start.                            |               |                    | Behavior might vary slightly based on OS.                                                           |

### 3.3 Recording Functionality

| Test Case ID | Description                                                           | Steps                                                                                                                            | Expected Result                                                                                                                                                              | Actual Result | Status (Pass/Fail) | Notes                                                        |
|--------------|-----------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------|--------------------|--------------------------------------------------------------|
| REC-001      | Start recording with Countdown ON                                       | 1. Ensure "Enable 3s Countdown" is ON. <br>2. Tap Play. <br>3. Wait for countdown to finish. <br>4. Record for 5s. <br>5. Tap Stop. | - Countdown overlay appears (3, 2, 1). <br>- Status: "Countdown..." -> "Starting in X..." -> "Recording...". <br>- Duration timer updates every second. <br>- Recording stops. File is processed. |               |                    |                                                              |
| REC-002      | Start recording with Countdown OFF                                      | 1. Ensure "Enable 3s Countdown" is OFF. <br>2. Tap Play. <br>3. Record for 5s. <br>4. Tap Stop.                                  | - No countdown overlay. <br>- Status: "Recording...". <br>- Duration timer updates. <br>- Recording stops. File is processed.                                                   |               |                    |                                                              |
| REC-003      | Stop recording successfully                                           | 1. Start recording. <br>2. Record for 5s. <br>3. Tap Stop.                                                                       | - Status: "Stopped". <br>- Duration resets to "00:00:00". <br>- UI elements (switch, dropdown) become enabled. <br>- File saving process is initiated.                              |               |                    |                                                              |
| REC-004      | Recording Status and Duration Timer updates                             | 1. Start recording. <br>2. Observe status text and duration timer for 10s.                                                       | - Status text remains "Recording...". <br>- Duration timer increments accurately every second (e.g., "00:00:01", "00:00:02", ...).                                          |               |                    |                                                              |
| REC-005      | Cancel Countdown                                                      | 1. Ensure "Enable 3s Countdown" is ON. <br>2. Tap Play. <br>3. During countdown (e.g., at '2'), tap the Stop button.              | - Countdown stops immediately. <br>- Overlay disappears. <br>- Status: "Stopped". <br>- No recording is started.                                                               |               |                    |                                                              |
| REC-006      | Record with 480p resolution                                           | 1. Select '480p' from dropdown. <br>2. Start and stop a short recording (5s).                                                    | - Recording completes. <br>- (Post-test) Saved file properties (if checkable) indicate resolution close to 854x480.                                                              |               |                    | Focus on successful recording and saving. Resolution hard to verify. |
| REC-007      | Record with 720p resolution                                           | 1. Select '720p' from dropdown. <br>2. Start and stop a short recording (5s).                                                     | - Recording completes. <br>- (Post-test) Saved file properties indicate resolution close to 1280x720.                                                             |               |                    |                                                              |
| REC-008      | Record with 1080p resolution                                          | 1. Select '1080p' from dropdown. <br>2. Start and stop a short recording (5s).                                                   | - Recording completes. <br>- (Post-test) Saved file properties indicate resolution close to 1920x1080.                                                            |               |                    |                                                              |
| REC-009      | Record with 2K resolution                                             | 1. Select '2K' from dropdown. <br>2. Start and stop a short recording (5s).                                                      | - Recording completes. <br>- (Post-test) Saved file properties indicate resolution close to 2048x1080.                                                            |               |                    |                                                              |
| REC-010      | Record with 4K resolution                                             | 1. Select '4K' from dropdown. <br>2. Start and stop a short recording (5s).                                                      | - Recording completes. <br>- (Post-test) Saved file properties indicate resolution close to 3840x2160.                                                            |               |                    | May be resource intensive.                                   |
| REC-011      | Consecutive Recordings (Start-Stop-Start-Stop)                        | 1. Start a recording, record for 3s, stop. <br>2. Immediately start a new recording, record for 3s, stop.                     | - Both recordings complete successfully. <br>- Two video files are saved.                                                                                       |               |                    |                                                              |

### 3.4 File Saving

| Test Case ID | Description                                                                 | Steps                                                                                                                             | Expected Result                                                                                                                                                             | Actual Result | Status (Pass/Fail) | Notes                                                                |
|--------------|-----------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------|--------------------|----------------------------------------------------------------------|
| SAVE-001     | Video saved to Gallery (Success)                                            | 1. Grant all permissions. <br>2. Record a 5s video. <br>3. Stop recording.                                                          | - SnackBar: "Processing video...". <br>- SnackBar: "Video saved to Gallery successfully!". <br>- (Manual Check) Video file exists in device gallery/expected photos location. |               |                    | Path in SnackBar for "Processing" might be too quick to read fully.  |
| SAVE-002     | Video playback (Conceptual)                                                 | 1. Record a 5s video and save it. <br>2. Open the video from the gallery using a video player.                                    | - Video plays smoothly. <br>- Audio is audible (if recorded with audio). <br>- Video content matches what was on screen. <br>- Duration matches recorded duration.              |               |                    | Requires manual check on a device/emulator with gallery & player.    |
| SAVE-003     | File saving failure (e.g., GallerySaver plugin returns false)               | 1. (Simulate if possible) Intercept or mock `GallerySaver.saveVideo` to return `false`. <br>2. Record and stop video.               | - SnackBar: "Processing video...". <br>- SnackBar: "Failed to save video to Gallery."                                                                                       |               |                    | Hard to test without modifying code or specific test hooks.          |
| SAVE-004     | File saving error (e.g., GallerySaver plugin throws exception)              | 1. (Simulate if possible) Intercept or mock `GallerySaver.saveVideo` to throw an exception. <br>2. Record and stop video.            | - SnackBar: "Processing video...". <br>- SnackBar: "Error saving video to Gallery: [exception message]".                                                                   |               |                    | Hard to test.                                                        |
| SAVE-005     | Recording stopped, but `stopRecordScreen` returns null filePath             | 1. (Simulate if possible) Intercept `FlutterScreenRecording.stopRecordScreen` to return `null`. <br>2. Record and stop video.        | - SnackBar: "Recording stopped, but no file was created." (if it was actually recording). <br>- No attempt to save to gallery.                                              |               |                    |                                                                      |

### 3.5 Error Handling & Edge Cases

| Test Case ID | Description                                                          | Steps                                                                                                                               | Expected Result                                                                                                                                  | Actual Result | Status (Pass/Fail) | Notes                                                                     |
|--------------|----------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------|---------------|--------------------|---------------------------------------------------------------------------|
| ERR-001      | Attempt to record with permissions denied                            | 1. Ensure permissions are denied (see PERM-002 or PERM-003). <br>2. Tap Play button.                                                 | - Appropriate SnackBar about missing permissions. <br>- Recording does not start. <br>- App remains stable.                                        |               |                    | Covered by Permission tests but good to re-verify from error perspective. |
| ERR-002      | Stop recording immediately after starting (within 1 second)            | 1. Tap Play, then immediately tap Stop (within 1 second, before duration timer visibly updates much).                               | - Recording stops. <br>- A very short video file might be created and saved (or plugin might discard it). <br>- App remains stable. <br>- Appropriate SnackBars. |               |                    | Behavior of plugin with very short files might vary.                      |
| ERR-003      | Start recording, then background the app, then return and stop       | 1. Start recording. <br>2. Send app to background (e.g. home button). <br>3. Wait 5s. <br>4. Bring app to foreground. <br>5. Tap Stop. | - Recording continues in background (expected, due to foreground service). <br>- Duration timer updates correctly upon return. <br>- Video is saved. |               |                    | Foreground service for recording is crucial here.                         |
| ERR-004      | (Simulated) Low storage space during recording                       | 1. (Conceptual) Imagine device runs out of storage while recording.                                                                 | - Plugin should ideally handle this by stopping recording. <br>- App should show an error message (e.g., "Failed to save video: No space").        |               |                    | Very hard to simulate. Plugin-dependent behavior.                         |
| ERR-005      | Multiple taps on Record button quickly                               | 1. Tap the Play button multiple times in rapid succession.                                                                          | - Recording should only start once (either countdown or actual). <br>- App remains stable. No multiple instances or errors.                       |               |                    | `_isRecording || _isCountingDown` check should prevent this.              |
| ERR-006      | Multiple taps on Stop button quickly                                 | 1. Start recording. <br>2. Tap the Stop button multiple times in rapid succession.                                                   | - Recording should only stop once. <br>- File saving process initiated once. <br>- App remains stable.                                            |               |                    |                                                                           |
| ERR-007      | Change resolution while countdown is active (should be disabled)     | 1. Enable countdown. <br>2. Tap Play. <br>3. While countdown numbers are showing, try to change resolution.                         | - Resolution dropdown should be disabled / non-interactive.                                                                                      |               |                    |                                                                           |
| ERR-008      | Toggle countdown switch while countdown is active (should be disabled) | 1. Enable countdown. <br>2. Tap Play. <br>3. While countdown numbers are showing, try to toggle the countdown switch.               | - Countdown switch should be disabled / non-interactive.                                                                                         |               |                    |                                                                           |

## 4. Unit Tests
Unit tests will be written for non-UI logic, primarily focusing on helper/utility functions. These tests will be placed in the `test/widget_test.dart` or a new `test/unit_tests.dart` file.

**Functions to test:**
- `_formatDuration(Duration duration)`
- `_resolutionValues` map (indirectly, by checking its usage or creating a helper if complex logic existed)

*(Unit test code will be provided in a separate step)*

## 5. Test Execution Strategy
- **Manual Testing:**
    - Test cases will be executed manually by following the steps outlined in this document.
    - If the app can be run in a local simulator/emulator via Flutter CLI, that will be the primary method.
    - Results (Actual Result, Status, Notes) will be recorded in this document.
- **Unit Testing:**
    - Unit tests will be executed using the `flutter test` command.
    - All unit tests must pass.

## 6. Success Criteria
- **Overall:** All critical and high priority manual test cases pass. All unit tests pass.
- **Specifics:**
    - No crashes or major bugs that prevent core functionality.
    - All UI elements are rendered correctly and are functional.
    - Permissions are handled correctly, and appropriate feedback is provided.
    - Recording starts and stops as expected, with and without countdown.
    - Video files are saved to the gallery successfully for all resolutions.
    - Error messages are user-friendly and guide the user where possible.

---
This concludes the `TEST_PLAN.md` content.
I will now create a basic unit test file.
